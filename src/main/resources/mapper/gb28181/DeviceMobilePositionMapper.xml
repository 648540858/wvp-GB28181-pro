<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.genersoft.iot.vmp.gb28181.dao.DeviceMobilePositionMapper">
    <insert id="insertNewPosition">
        INSERT INTO wvp_device_mobile_position
        (device_id, channel_id, device_name, time, longitude, latitude, altitude, speed, direction, report_source,
         create_time)
        VALUES (#{deviceId}, #{channelId}, #{deviceName}, #{time}, #{longitude}, #{latitude}, #{altitude}, #{speed},
                #{direction}, #{reportSource}, #{createTime})
    </insert>

    <select id="queryPositionByDeviceIdAndTime" resultType="com.genersoft.iot.vmp.gb28181.bean.MobilePosition">
        SELECT * FROM wvp_device_mobile_position
        WHERE device_id = #{deviceId}
        <if test="channelId != null">and channel_id = #{channelId}</if>
        <if test="startTime != null">AND time&gt;=#{startTime}</if>
        <if test="endTime != null">AND time&lt;=#{endTime}</if>
        ORDER BY time
    </select>
    <select id="queryLatestPositionByDevice" resultType="com.genersoft.iot.vmp.gb28181.bean.MobilePosition">
        SELECT *
        FROM wvp_device_mobile_position
        WHERE device_id = #{deviceId}
        ORDER BY time DESC
        LIMIT 1
    </select>

    <delete id="clearMobilePositionsByDeviceId">
        DELETE FROM wvp_device_mobile_position WHERE device_id = #{deviceId}
    </delete>

    <insert id="batchadd">
        <foreach collection='mobilePositions' index='index' item='item' separator=';'>
            insert into wvp_device_mobile_position
            (device_id,channel_id, device_name,time,longitude,latitude,altitude,speed,direction,report_source,
            create_time)
            values
            (#{item.deviceId}, #{item.channelId}, #{item.deviceName}, #{item.time}, #{item.longitude},
            #{item.latitude}, #{item.altitude}, #{item.speed},#{item.direction},
            #{item.reportSource}, #{item.createTime})
        </foreach>
    </insert>
</mapper>